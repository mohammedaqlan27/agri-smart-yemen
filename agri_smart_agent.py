import os
import pandas as pd
import google.generativeai as genai
from dotenv import load_dotenv

# 1. ุชุญููู ุงูุฅุนุฏุงุฏุงุช ูู ููู .env (ููุฃูุงู)
load_dotenv()
API_KEY = os.getenv("GEMINI_API_KEY")

if not API_KEY:
    print("โ๏ธ ุฎุทุฃ: ูู ูุชู ุงูุนุซูุฑ ุนูู ููุชุงุญ API. ุชุฃูุฏ ูู ุฅุถุงูุชู ูู ููู .env")
else:
    genai.configure(api_key=API_KEY)

# 2. ุฅุนุฏุงุฏ ูููุฐุฌ ุงูุฐูุงุก ุงูุงุตุทูุงุนู
model = genai.GenerativeModel('gemini-pro')

def get_farming_advice(weather_data, location="ุงูููู"):
    """ุฏุงูุฉ ูุชูุฏูู ูุตูุญุฉ ุฒุฑุงุนูุฉ ุจูุงุกู ุนูู ุงูุจูุงูุงุช"""
    prompt = f"""
    ุฃูุช ุฎุจูุฑ ุฒุฑุงุนู ูุชุฎุตุต ูู ุงูุจูุฆุฉ ุงูููููุฉ. 
    ุจูุงุกู ุนูู ุจูุงูุงุช ุงูุทูุณ ุงูุชุงููุฉ ูู ููุทูุฉ {location}:
    {weather_data}
    
    ูุฑุฌู ุชูุฏูู ูุตูุญุฉ ุชุดูู:
    1. ุฃูุถู ุงููุญุงุตูู ุงูุจุฏููุฉ ูููุงุช ุงูุชู ุชููุฑ ุงูููุงู.
    2. ูุตูุญุฉ ูุชุฑุดูุฏ ุงุณุชููุงู ุงูููุงู ุงูุฌูููุฉ.
    3. ุชููุนุงุช ููุฌุงุญ ุฒุฑุงุนุฉ ุงูุญุจูุจ ุฃู ุงูุฎุถุฑูุงุช ูู ูุฐู ุงูุธุฑูู.
    ุงุฌุนู ุงูุฅุฌุงุจุฉ ูุดุฌุนุฉ ูุจุงููุบุฉ ุงูุนุฑุจูุฉ.
    """
    
    response = model.generate_content(prompt)
    return response.text

# 3. ุชุดุบูู ุงูุจุฑูุงูุฌ ุงูุชุฌุฑูุจู
if __name__ == "__main__":
    print("--- ๐ฟ ูุธุงู AgriSmart Yemen ููุฒุฑุงุนุฉ ุงูุฐููุฉ ---")
    
    # ูุซุงู ูุจูุงูุงุช ุทูุณ (ูููู ูุงุญูุงู ุฑุจุทูุง ุจููู CSV ุฃู API)
    sample_weather = "ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ: 25 ูุฆููุฉุ ุงูุฑุทูุจุฉ: 40%ุ ูุนุฏู ุงูุฃูุทุงุฑ: ููุฎูุถ"
    
    print("\nุฌุงุฑู ุชุญููู ุงูุจูุงูุงุช ูุทูุจ ุงููุตูุญุฉ ูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู...")
    try:
        advice = get_farming_advice(sample_weather)
        print("\nโ ุงูุชูุตูุฉ ุงูุฒุฑุงุนูุฉ:")
        print(advice)
    except Exception as e:
        print(f"โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุงุชุตุงู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู: {e}")
